# 🧪 本地测试指南

GameVideoGen 项目的本地测试工具集

## 📦 准备工作

### 1. 确保已安装 Node.js
```bash
node --version  # 应该 >= 16.0.0
```

### 2. 安装依赖
```bash
cd C:\Users\jojo1\jilo-ai\game-video-gen
npm install
```

或双击 `INSTALL.bat`

## 🚀 快速开始

### 方式一: 使用测试菜单 (推荐)

双击 `test_menu.bat` 打开交互式菜单:

```
╔════════════════════════════════════════════════════════════╗
║        🎮 GameVideoGen 本地测试菜单                        ║
╚════════════════════════════════════════════════════════════╝

选择测试类型:

  [1] 快速测试 (4秒视频, 最便宜最快)
  [2] 《狱国争霸》完整测试 (12秒, 抖音竖屏)
  [3] 抖音平台测试 (8秒, 竖屏)
  [4] YouTube平台测试 (12秒, 横屏)
  [5] 快手平台测试 (4秒, 竖屏)
  [6] 查看测试指南
  [0] 退出
```

### 方式二: 使用单独的批处理文件

- **快速测试**: 双击 `quick_test.bat`
- **完整测试**: 双击 `run_prison_test.bat`

### 方式三: 使用命令行

```bash
# 快速测试 (4秒)
node simple_test.js

# 完整测试 (12秒)
node test_prison_battle.js

# 自定义配置测试
node test_configs.js <platform> <duration>

# 示例
node test_configs.js douyin 8      # 抖音 8秒
node test_configs.js youtube 12    # YouTube 12秒
node test_configs.js kuaishou 4    # 快手 4秒
```

## 📝 测试脚本说明

### 1. `simple_test.js` - 快速测试
- **时长**: 4秒
- **成本**: ~$0.08-0.12
- **用途**: 快速验证 API 是否正常工作
- **适合**: 第一次测试或快速验证

### 2. `test_prison_battle.js` - 完整测试
- **时长**: 12秒
- **成本**: ~$0.20-0.30
- **用途**: 测试《狱国争霸》完整宣传视频
- **适合**: 验证完整功能和内容质量

### 3. `test_configs.js` - 配置测试
- **时长**: 4/8/12秒 可选
- **平台**: 抖音/快手/YouTube
- **用途**: 测试不同平台和时长的组合
- **适合**: 验证平台适配和多场景测试

## 🎯 测试目标

根据 PRD 文档,我们需要验证:

✅ **平台适配**
- 抖音: 快节奏、强冲击力、竖屏(9:16)
- 快手: 真实接地气、竖屏(9:16)
- YouTube: 精良制作、横屏(16:9)

✅ **时长选择**
- 4秒: 2个场景
- 8秒: 4个场景
- 12秒: 6个场景

✅ **视频质量**
- 分辨率: 1080p
- 音频: 自动生成并同步
- 格式: MP4

## ⏱️ 预期时间

| 时长 | 生成时间 | 成本 |
|------|---------|------|
| 4秒  | 30-60秒 | ~$0.10 |
| 8秒  | 60-90秒 | ~$0.18 |
| 12秒 | 90-120秒 | ~$0.25 |

## 📊 测试结果示例

成功后会看到:

```
✅ 生成成功！总耗时: 67.23秒

📹 视频信息:
   - 视频URL: https://v3.fal.media/files/...
   - 文件大小: 2.34 MB
   - 视频时长: 12秒
   - 内容类型: video/mp4
   - 视频比例: 9:16 (竖屏)

🔗 视频下载链接:
   https://v3.fal.media/files/...
```

## 🔍 如何查看生成的视频

1. 复制控制台输出的视频 URL
2. 在浏览器中打开链接
3. 视频会自动播放
4. 右键 -> "视频另存为" 下载到本地

## ❌ 故障排查

### 问题 1: 找不到模块
```
Error: Cannot find module '@fal-ai/serverless-client'
```

**解决**: 
```bash
npm install
```

### 问题 2: API 认证失败
```
Error: Unauthorized
```

**解决**: 
- 检查 API Key 是否正确
- 确认 API Key 有足够的配额

### 问题 3: 网络超时
```
Error: ECONNREFUSED
```

**解决**: 
- 检查网络连接
- 使用 VPN (如果在中国大陆)
- 稍后重试

### 问题 4: 生成失败
```
Error: Video generation failed
```

**解决**: 
- 检查 FAL.AI 服务状态: https://status.fal.ai/
- 尝试调整 prompt
- 减少视频时长重试

## 🧪 测试清单

完成以下测试来验证所有功能:

- [ ] 快速测试通过 (4秒)
- [ ] 抖音平台测试 (8秒, 竖屏)
- [ ] 快手平台测试 (4秒, 竖屏)
- [ ] YouTube平台测试 (12秒, 横屏)
- [ ] 完整《狱国争霸》测试 (12秒)
- [ ] 视频可以正常下载和播放
- [ ] 视频音频同步正常
- [ ] 视频格式符合预期

## 📚 相关文档

- **PRD 文档**: `jilo-ai_game-video-gen_PRD_V1_0_MVP_REVISED.md`
- **详细测试指南**: `local_test_guide.md`
- **项目说明**: `README_PRISON_BATTLE.md`

## 🎯 下一步

测试成功后,可以:

1. **开发 Web 界面**
   - 使用 Next.js 创建用户界面
   - 集成表单输入
   - 显示进度条

2. **集成 OpenAI**
   - 自动生成脚本
   - 根据平台优化内容
   - 支持多语言

3. **添加数据库**
   - 使用 Supabase
   - 存储生成历史
   - 用户认证

4. **部署上线**
   - Vercel 部署
   - 配置域名
   - 监控和优化

## 💡 提示

- 首次测试建议使用 4秒快速测试,成本最低
- 如果需要调试,运行: `node test_prison_battle.js --debug`
- 所有测试使用相同的 API Key,请确保有足够配额
- 生成的视频链接有效期为 24 小时,请及时下载

## 🆘 获取帮助

如果遇到问题:
1. 查看完整错误信息
2. 检查 `local_test_guide.md`
3. 访问 FAL.AI 文档: https://fal.ai/models/sora-2
4. 检查服务状态: https://status.fal.ai/

---

**最后更新**: 2025-10-27
**项目版本**: V1.0 MVP
